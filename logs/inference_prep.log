2025-04-10 12:02:57 - INFO - Logging has been set up successfully.
2025-04-10 12:02:57 - INFO - Starting main function...
2025-04-10 12:02:57 - INFO - Mode: load
2025-04-10 12:02:57 - INFO - Starting build_catboost_model: Training CatBoost Models -- 20 total
2025-04-10 12:02:57 - INFO - Query training_data located and loading from PostgreSQL...
2025-04-10 12:02:58 - INFO - Data loaded from PostgreSQL in 1.16 seconds.
2025-04-10 12:03:09 - INFO - Data loaded from PostgreSQL. Count: 273032
2025-04-10 12:03:20 - INFO - Row count: course_cd       273032
race_date       273032
race_number     273032
group_id        273032
class_rating    273032
                 ...  
embed_4         273032
embed_5         273032
embed_6         273032
embed_7         273032
embed_8         273032
Length: 184, dtype: int64
2025-04-10 12:03:20 - INFO - Count operation completed in 22.92 seconds.
2025-04-10 12:03:22 - INFO - Shape of historical Pandas DF: (273032, 184)
2025-04-10 12:03:22 - INFO - Shape of Historical Pandas DF: (273032, 184)
2025-04-10 12:03:22 - INFO - train_data - horse_id and group_id combination unique: True
2025-04-10 12:03:22 - INFO - valid_data - horse_id and group_id combination unique: True
2025-04-10 12:03:22 - INFO - holdout_data - horse_id and group_id combination unique: True
2025-04-10 12:03:22 - INFO - === Starting cross-validation for QueryRMSE with NDCG:top=2 ===
2025-04-10 12:03:22 - INFO - Train indices: [0 1 2 3 4 5 6 7 8 9]... Valid indices: [26767 26768 26769 26770 26771 26772 26773 26774 26775 26776]...
2025-04-10 12:03:22 - INFO - X_train_fold shape: (26767, 164), X_valid_fold shape: (26767, 164)
2025-04-10 12:03:22 - INFO - y_train_fold shape: (26767,), y_valid_fold shape: (26767,)
2025-04-10 12:03:29 - INFO - metric_top1_hit = 0.8112
2025-04-10 12:03:29 - INFO - Train indices: [0 1 2 3 4 5 6 7 8 9]... Valid indices: [53534 53535 53536 53537 53538 53539 53540 53541 53542 53543]...
2025-04-10 12:03:29 - INFO - X_train_fold shape: (53534, 164), X_valid_fold shape: (26767, 164)
2025-04-10 12:03:29 - INFO - y_train_fold shape: (53534,), y_valid_fold shape: (26767,)
2025-04-10 12:03:37 - INFO - metric_top1_hit = 0.8067
2025-04-10 12:03:37 - INFO - Train indices: [0 1 2 3 4 5 6 7 8 9]... Valid indices: [80301 80302 80303 80304 80305 80306 80307 80308 80309 80310]...
2025-04-10 12:03:37 - INFO - X_train_fold shape: (80301, 164), X_valid_fold shape: (26767, 164)
2025-04-10 12:03:37 - INFO - y_train_fold shape: (80301,), y_valid_fold shape: (26767,)
2025-04-10 12:03:50 - INFO - metric_top1_hit = 0.8224
2025-04-10 12:03:50 - INFO - Train indices: [0 1 2 3 4 5 6 7 8 9]... Valid indices: [107068 107069 107070 107071 107072 107073 107074 107075 107076 107077]...
2025-04-10 12:03:50 - INFO - X_train_fold shape: (107068, 164), X_valid_fold shape: (26767, 164)
2025-04-10 12:03:50 - INFO - y_train_fold shape: (107068,), y_valid_fold shape: (26767,)
2025-04-10 12:04:05 - INFO - metric_top1_hit = 0.8263
2025-04-10 12:04:05 - INFO - Train indices: [0 1 2 3 4 5 6 7 8 9]... Valid indices: [133835 133836 133837 133838 133839 133840 133841 133842 133843 133844]...
2025-04-10 12:04:05 - INFO - X_train_fold shape: (133835, 164), X_valid_fold shape: (26767, 164)
2025-04-10 12:04:05 - INFO - y_train_fold shape: (133835,), y_valid_fold shape: (26767,)
2025-04-10 12:04:24 - INFO - metric_top1_hit = 0.8352
2025-04-10 12:04:24 - INFO - Cross-validation top3-in-top3 fraction score: 0.8203632006164305
2025-04-10 12:04:24 - INFO - Trial 30 with QueryRMSE, NDCG:top=2
2025-04-10 12:04:31 - INFO - Trial 31 with QueryRMSE, NDCG:top=2
2025-04-10 12:05:01 - INFO - Trial 32 with QueryRMSE, NDCG:top=2
2025-04-10 12:05:21 - INFO - Trial 33 with QueryRMSE, NDCG:top=2
2025-04-10 12:05:47 - INFO - Trial 34 with QueryRMSE, NDCG:top=2
2025-04-10 12:06:21 - INFO - Trial 35 with QueryRMSE, NDCG:top=2
2025-04-10 12:07:00 - INFO - Trial 36 with QueryRMSE, NDCG:top=2
2025-04-10 12:07:44 - INFO - Trial 37 with QueryRMSE, NDCG:top=2
2025-04-10 12:08:09 - INFO - Trial 38 with QueryRMSE, NDCG:top=2
2025-04-10 12:08:19 - INFO - Trial 39 with QueryRMSE, NDCG:top=2
2025-04-10 12:08:53 - INFO - Trial 40 with QueryRMSE, NDCG:top=2
2025-04-10 12:09:26 - INFO - Trial 41 with QueryRMSE, NDCG:top=2
2025-04-10 12:09:48 - INFO - Trial 42 with QueryRMSE, NDCG:top=2
2025-04-10 12:10:21 - INFO - Trial 43 with QueryRMSE, NDCG:top=2
2025-04-10 12:10:51 - INFO - Trial 44 with QueryRMSE, NDCG:top=2
2025-04-10 12:11:21 - INFO - Trial 45 with QueryRMSE, NDCG:top=2
2025-04-10 12:11:52 - INFO - Trial 46 with QueryRMSE, NDCG:top=2
2025-04-10 12:12:29 - INFO - Trial 47 with QueryRMSE, NDCG:top=2
2025-04-10 12:13:09 - INFO - Trial 48 with QueryRMSE, NDCG:top=2
2025-04-10 12:13:16 - INFO - Trial 49 with QueryRMSE, NDCG:top=2
2025-04-10 12:13:57 - INFO - Trial 50 with QueryRMSE, NDCG:top=2
2025-04-10 12:14:45 - INFO - Trial 51 with QueryRMSE, NDCG:top=2
2025-04-10 12:15:18 - INFO - Trial 52 with QueryRMSE, NDCG:top=2
2025-04-10 12:15:54 - INFO - Trial 53 with QueryRMSE, NDCG:top=2
2025-04-10 12:16:28 - INFO - Trial 54 with QueryRMSE, NDCG:top=2
2025-04-10 12:17:15 - INFO - Trial 55 with QueryRMSE, NDCG:top=2
2025-04-10 12:18:04 - INFO - Trial 56 with QueryRMSE, NDCG:top=2
2025-04-10 12:18:38 - INFO - Trial 57 with QueryRMSE, NDCG:top=2
2025-04-10 12:19:15 - INFO - Trial 58 with QueryRMSE, NDCG:top=2
2025-04-10 12:19:55 - INFO - Trial 59 with QueryRMSE, NDCG:top=2
2025-04-10 12:20:23 - INFO - Best score: 0.8403064230995875, Best params: {'bagging_temperature': 0.30000000000000004, 'depth': 9, 'iterations': 4500, 'l2_leaf_reg': 7.9775731867161515, 'learning_rate': 0.007350228296471497, 'min_data_in_leaf': 30, 'random_strength': 1.8795611292679657}
2025-04-10 12:22:39 - INFO - Saved model with train+valid predictions to /home/exx/myCode/horse-racing/FoxRiverAIRacing/data/models/catboost/catboost_QueryRMSE_NDCG:top=2_20250410_122023.cbm
2025-04-10 12:22:39 - INFO - Evaluating model: QueryRMSE_NDCG:top=2_20250410_122023 from /home/exx/myCode/horse-racing/FoxRiverAIRacing/data/models/catboost/catboost_QueryRMSE_NDCG:top=2_20250410_122023.cbm
2025-04-10 12:22:39 - INFO - Loaded CatBoost model: /home/exx/myCode/horse-racing/FoxRiverAIRacing/data/models/catboost/catboost_QueryRMSE_NDCG:top=2_20250410_122023.cbm
2025-04-10 12:22:39 - INFO - Final holdout_merged dataset size: (62655, 186)
2025-04-10 12:22:53 - INFO - Holdout Evaluation Results:
{
  "model_key": "QueryRMSE_NDCG:top=2_20250410_122023",
  "total_groups_evaluated": 8234,
  "avg_top_1_accuracy": 0.8396890940004857,
  "avg_top_4_accuracy": 0.16079669662375518,
  "perfect_order_percentage": 0.03084770463930046,
  "avg_top3_in_top3": 0.16869079426767064,
  "top3_in_top4_fraction": 0.38766091814427983,
  "MRR": 0.9077204125995723,
  "avg_ndcg_3": 0.8372796632191614,
  "avg_ndcg_4": 0.8711934021846844,
  "spearman_corr": 0.5285275039125661,
  "RMSE": 39.66844400492762,
  "MAE": 32.30225541867012,
  "prediction_variance": 23.582368557774018
}
2025-04-10 12:22:53 - INFO - No duplicates found in holdout_merged based on columns ['horse_id', 'group_id'].
2025-04-10 12:23:25 - INFO - Appended 62655 holdout rows to DB table 'catboost_enriched_results'.
2025-04-10 12:23:25 - INFO - Saved holdout metrics to ./data/training/holdout_metrics/holdout_metrics_QueryRMSE_NDCG:top=2_20250410_122023.json
2025-04-10 12:23:25 - INFO - === Starting cross-validation for QueryRMSE with NDCG:top=3 ===
2025-04-10 12:23:25 - INFO - Train indices: [0 1 2 3 4 5 6 7 8 9]... Valid indices: [26767 26768 26769 26770 26771 26772 26773 26774 26775 26776]...
2025-04-10 12:23:25 - INFO - X_train_fold shape: (26767, 164), X_valid_fold shape: (26767, 164)
2025-04-10 12:23:25 - INFO - y_train_fold shape: (26767,), y_valid_fold shape: (26767,)
2025-04-10 12:23:32 - INFO - metric_top1_hit = 0.8123
2025-04-10 12:23:32 - INFO - Train indices: [0 1 2 3 4 5 6 7 8 9]... Valid indices: [53534 53535 53536 53537 53538 53539 53540 53541 53542 53543]...
2025-04-10 12:23:32 - INFO - X_train_fold shape: (53534, 164), X_valid_fold shape: (26767, 164)
2025-04-10 12:23:32 - INFO - y_train_fold shape: (53534,), y_valid_fold shape: (26767,)
2025-04-10 12:23:40 - INFO - metric_top1_hit = 0.8073
2025-04-10 12:23:40 - INFO - Train indices: [0 1 2 3 4 5 6 7 8 9]... Valid indices: [80301 80302 80303 80304 80305 80306 80307 80308 80309 80310]...
2025-04-10 12:23:40 - INFO - X_train_fold shape: (80301, 164), X_valid_fold shape: (26767, 164)
2025-04-10 12:23:40 - INFO - y_train_fold shape: (80301,), y_valid_fold shape: (26767,)
2025-04-10 12:23:51 - INFO - metric_top1_hit = 0.8239
2025-04-10 12:23:51 - INFO - Train indices: [0 1 2 3 4 5 6 7 8 9]... Valid indices: [107068 107069 107070 107071 107072 107073 107074 107075 107076 107077]...
2025-04-10 12:23:51 - INFO - X_train_fold shape: (107068, 164), X_valid_fold shape: (26767, 164)
2025-04-10 12:23:51 - INFO - y_train_fold shape: (107068,), y_valid_fold shape: (26767,)
2025-04-10 12:24:03 - INFO - metric_top1_hit = 0.8225
2025-04-10 12:24:03 - INFO - Train indices: [0 1 2 3 4 5 6 7 8 9]... Valid indices: [133835 133836 133837 133838 133839 133840 133841 133842 133843 133844]...
2025-04-10 12:24:03 - INFO - X_train_fold shape: (133835, 164), X_valid_fold shape: (26767, 164)
2025-04-10 12:24:03 - INFO - y_train_fold shape: (133835,), y_valid_fold shape: (26767,)
2025-04-10 12:24:22 - INFO - metric_top1_hit = 0.8361
2025-04-10 12:24:22 - INFO - Cross-validation top3-in-top3 fraction score: 0.8204052132494171
2025-04-10 12:24:22 - INFO - Trial 30 with QueryRMSE, NDCG:top=3
2025-04-10 12:24:28 - INFO - Trial 31 with QueryRMSE, NDCG:top=3
2025-04-10 12:24:57 - INFO - Trial 32 with QueryRMSE, NDCG:top=3
2025-04-10 12:25:29 - INFO - Trial 33 with QueryRMSE, NDCG:top=3
2025-04-10 12:26:14 - INFO - Trial 34 with QueryRMSE, NDCG:top=3
2025-04-10 12:26:47 - INFO - Trial 35 with QueryRMSE, NDCG:top=3
2025-04-10 12:27:45 - INFO - Trial 36 with QueryRMSE, NDCG:top=3
2025-04-10 12:28:24 - INFO - Trial 37 with QueryRMSE, NDCG:top=3
2025-04-10 12:28:50 - INFO - Trial 38 with QueryRMSE, NDCG:top=3
2025-04-10 12:29:19 - INFO - Trial 39 with QueryRMSE, NDCG:top=3
2025-04-10 12:29:58 - INFO - Trial 40 with QueryRMSE, NDCG:top=3
2025-04-10 12:30:04 - INFO - Trial 41 with QueryRMSE, NDCG:top=3
2025-04-10 12:30:36 - INFO - Trial 42 with QueryRMSE, NDCG:top=3
2025-04-10 12:31:15 - INFO - Trial 43 with QueryRMSE, NDCG:top=3
2025-04-10 12:31:55 - INFO - Trial 44 with QueryRMSE, NDCG:top=3
2025-04-10 12:32:48 - INFO - Trial 45 with QueryRMSE, NDCG:top=3
2025-04-10 12:33:27 - INFO - Trial 46 with QueryRMSE, NDCG:top=3
2025-04-10 12:34:38 - INFO - Trial 47 with QueryRMSE, NDCG:top=3
2025-04-10 12:35:15 - INFO - Trial 48 with QueryRMSE, NDCG:top=3
2025-04-10 12:35:50 - INFO - Trial 49 with QueryRMSE, NDCG:top=3
2025-04-10 12:36:33 - INFO - Trial 50 with QueryRMSE, NDCG:top=3
2025-04-10 12:37:03 - INFO - Trial 51 with QueryRMSE, NDCG:top=3
2025-04-10 12:37:40 - INFO - Trial 52 with QueryRMSE, NDCG:top=3
2025-04-10 12:38:21 - INFO - Trial 53 with QueryRMSE, NDCG:top=3
2025-04-10 12:38:58 - INFO - Trial 54 with QueryRMSE, NDCG:top=3
2025-04-10 12:39:56 - INFO - Trial 55 with QueryRMSE, NDCG:top=3
2025-04-10 12:40:31 - INFO - Trial 56 with QueryRMSE, NDCG:top=3
2025-04-10 12:41:12 - INFO - Trial 57 with QueryRMSE, NDCG:top=3
2025-04-10 12:42:00 - INFO - Trial 58 with QueryRMSE, NDCG:top=3
2025-04-10 12:43:01 - INFO - Trial 59 with QueryRMSE, NDCG:top=3
2025-04-10 12:43:49 - INFO - Best score: 0.8413376546847378, Best params: {'bagging_temperature': 0.30000000000000004, 'depth': 9, 'iterations': 3350, 'l2_leaf_reg': 10.449283825883619, 'learning_rate': 0.007607169809678587, 'min_data_in_leaf': 20, 'random_strength': 2.304727875600694}
2025-04-10 12:46:07 - INFO - Saved model with train+valid predictions to /home/exx/myCode/horse-racing/FoxRiverAIRacing/data/models/catboost/catboost_QueryRMSE_NDCG:top=3_20250410_124349.cbm
2025-04-10 12:46:07 - INFO - Evaluating model: QueryRMSE_NDCG:top=3_20250410_124349 from /home/exx/myCode/horse-racing/FoxRiverAIRacing/data/models/catboost/catboost_QueryRMSE_NDCG:top=3_20250410_124349.cbm
2025-04-10 12:46:07 - INFO - Loaded CatBoost model: /home/exx/myCode/horse-racing/FoxRiverAIRacing/data/models/catboost/catboost_QueryRMSE_NDCG:top=3_20250410_124349.cbm
2025-04-10 12:46:07 - INFO - Final holdout_merged dataset size: (62655, 186)
2025-04-10 12:46:20 - INFO - Holdout Evaluation Results:
{
  "model_key": "QueryRMSE_NDCG:top=3_20250410_124349",
  "total_groups_evaluated": 8234,
  "avg_top_1_accuracy": 0.8392033033762448,
  "avg_top_4_accuracy": 0.16128248724799613,
  "perfect_order_percentage": 0.030726256983240222,
  "avg_top3_in_top3": 0.16529025989798396,
  "top3_in_top4_fraction": 0.38802526111246055,
  "MRR": 0.9072659959531467,
  "avg_ndcg_3": 0.835857717028409,
  "avg_ndcg_4": 0.8709979883360645,
  "spearman_corr": 0.530399274795969,
  "RMSE": 39.6894410863524,
  "MAE": 32.322984312212476,
  "prediction_variance": 23.453391750723956
}
2025-04-10 12:46:20 - INFO - No duplicates found in holdout_merged based on columns ['horse_id', 'group_id'].
2025-04-10 12:46:53 - INFO - Appended 62655 holdout rows to DB table 'catboost_enriched_results'.
2025-04-10 12:46:53 - INFO - Saved holdout metrics to ./data/training/holdout_metrics/holdout_metrics_QueryRMSE_NDCG:top=3_20250410_124349.json
2025-04-10 12:46:53 - INFO - === Done training & evaluating all models ===
2025-04-10 12:46:53 - INFO - Saved final_feature_cols to /home/exx/myCode/horse-racing/FoxRiverAIRacing/data/training/final_feature_cols_20250410_124653.json
2025-04-10 12:46:54 - INFO - Spark session stopped.
2025-04-10 12:46:54 - INFO - Closing down clientserver connection
